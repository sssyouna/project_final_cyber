# SharePy Vulnerability Report

This report identifies and documents the location of each of the 15 security misconfigurations (M1-M15) in the vulnerable version of the SharePy application.

## M1: Admin Password in Clear Text

**Location**: Multiple files
- `backend/.env` (lines 1-6): Hardcoded database credentials and admin password
- `backend/main.py` (lines 9-10): Hardcoded admin credentials in source code

**Description**: Administrative credentials are stored in plain text in configuration files and source code, making them easily accessible to anyone with file access.

## M2: Debug Mode Enabled

**Location**: `backend/main.py` (line 13)
```python
app = FastAPI(debug=True)
```

**Description**: FastAPI is running in debug mode, which exposes detailed error messages and stack traces that can reveal sensitive information about the application's internal structure.

## M3: Directory Listing Enabled

**Location**: `nginx/nginx.conf` (lines 17-20)
```nginx
location /uploads {
    alias /usr/share/nginx/html/uploads;
    autoindex on;  # VULNERABLE!
}
```

**Description**: Nginx is configured to allow directory browsing of the uploads directory, enabling unauthorized access to all uploaded files.

## M4: Sensitive Files Accessible

**Location**: `nginx/nginx.conf` (lines 22-25) and `docker-compose.yml` (lines 21-22)
```nginx
location ~ /\.(env|git) {
    alias /usr/share/nginx/html;
    autoindex on;
}
```

```yaml
volumes:
  - ./backend/.env:/usr/share/nginx/html/.env  # M4: EXPOSED!
  - ./backend/.git:/usr/share/nginx/html/.git  # M4: EXPOSED!
```

**Description**: Sensitive configuration files (.env) and version control data (.git) are exposed through the web server and mounted as volumes in the docker-compose configuration.

## M5: pgAdmin/Adminer Publicly Accessible

**Location**: `docker-compose.yml` (lines 44-50)
```yaml
# M5 & M12: Adminer exposed without auth
adminer:
  image: adminer
  ports:
    - "8080:8080"  # M5: PUBLIC ACCESS!
  depends_on:
    - postgres
```

**Description**: The Adminer database administration tool is exposed on port 8080 without any authentication, allowing direct access to the PostgreSQL database.

## M6: MinIO Public Bucket + Keys in Code

**Location**: Multiple files
- `backend/.env` (lines 3-4): MinIO credentials
- `backend/main.py` (lines 17-18): Hardcoded MinIO credentials
- `docker-compose.yml` (lines 57-65): MinIO service exposed on ports 9000 and 9001

**Description**: MinIO credentials are hardcoded in both configuration files and source code, and the service is exposed on public ports.

## M7: CORS Wildcard

**Location**: `backend/main.py` (lines 15-21)
```python
# M7: CORS wildcard
app.add_middleware(
    CORSMiddleware,
    allow_origins=["*"],
    allow_credentials=True,
    allow_methods=["*"],
    allow_headers=["*"],
)
```

**Description**: Cross-Origin Resource Sharing is configured with wildcards, allowing any origin to make requests to the application, which can enable CSRF and data exfiltration attacks.

## M8: No Security Headers

**Location**: `nginx/nginx.conf` (lines 27-28)
```nginx
# M8: No security headers
# Missing: HSTS, CSP, X-Content-Type-Options, X-Frame-Options
```

**Description**: The Nginx configuration lacks essential security headers that protect against common web vulnerabilities such as XSS, clickjacking, and MIME-type sniffing.

## M9: Insecure Cookies

**Location**: `backend/main.py` (lines 30-31)
```python
# M9: Insecure cookies (no Secure, HttpOnly, SameSite)
response.set_cookie("session", token)  # INSECURE!
```

**Description**: Session cookies are set without the Secure, HttpOnly, or SameSite flags, making them vulnerable to interception and CSRF attacks.

## M10: Default FastAPI/Uvicorn Banner

**Location**: `backend/Dockerfile` (line 13)
```dockerfile
# M2: Debug mode enabled in startup
CMD ["uvicorn", "main:app", "--host", "0.0.0.0", "--port", "8000", "--reload"]
```

**Description**: The default Uvicorn server configuration reveals version information in HTTP response headers, which can be used by attackers to identify and target known vulnerabilities.

## M11: Verbose Nginx Errors

**Location**: `nginx/nginx.conf` (lines 7-8)
```nginx
# M11: Verbose error logging
error_log /var/log/nginx/error.log debug;
```

**Description**: Nginx is configured with debug-level error logging, which can reveal sensitive information about file paths and system configuration in error responses.

## M12: Internal Ports Exposed

**Location**: `docker-compose.yml` (lines 39-41, 60-62, 69-70)
```yaml
# M12: Internal ports exposed publicly
postgres:
  ports:
    - "5432:5432"  # M12: EXPOSED!

# M6 & M12: MinIO with default credentials and exposed port
minio:
  ports:
    - "9000:9000"  # M12: EXPOSED!
    - "9001:9001"

backend:
  ports:
    - "8000:8000"
```

**Description**: Internal services (PostgreSQL, MinIO) are exposed on public ports, bypassing application-level security controls.

## M13: chmod 777 on Uploads

**Location**: `backend/Dockerfile` (line 11)
```dockerfile
# M13: chmod 777 on uploads directory
RUN mkdir -p /app/uploads && chmod 777 /app/uploads
```

**Description**: The uploads directory is set with world-writable permissions (777), allowing any process or user to modify or delete files in this directory.

## M14: /debug/info Endpoint

**Location**: `backend/main.py` (lines 23-29)
```python
# M14: Debug endpoint that dumps environment
@app.get("/debug/info")
def debug_info():
    return {
        "env": dict(os.environ),
        "cwd": os.getcwd(),
        "files": os.listdir(".")
    }
```

**Description**: A debug endpoint is exposed that dumps all environment variables, current working directory, and file listings, revealing sensitive configuration data.

## M15: Weak JWT Secret

**Location**: Multiple files
- `backend/.env` (line 6): Weak JWT secret
- `backend/main.py` (lines 12, 27): Hardcoded weak JWT secret

**Description**: The JWT secret is weak and predictable, making it susceptible to brute-force attacks and token forging.